<!DOCTYPE html>

<html lang="zh-CN">

<head>
  
  <title>标签：https - 冬天</title>
  <meta charset="UTF-8">
  <meta name="description" content="冬天Blog">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  
  

  <link rel="shortcut icon" href="/favicon.ico" type="image/png" />
  <meta name="description" content="冬天Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="冬天">
<meta property="og:url" content="http://liangdonglin.cn/tags/https/index.html">
<meta property="og:site_name" content="冬天">
<meta property="og:description" content="冬天Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="冬天">
<meta property="article:tag" content="冬天Blog">
<meta name="twitter:card" content="summary">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,gh/nexmoe/nexmoe.github.io@latest/lib/mdui_043tiny/css/mdui.css,gh/nexmoe/nexmoe.github.io@latest/lib/iconfont/iconfont.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css?v=233" crossorigin>
  
  <link rel="stylesheet" href="/css/style.css?v=1608289167995">
<meta name="generator" content="Hexo 5.2.0"></head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(https://cdn.jsdelivr.net/gh/liangdongin/blog@latest/images/background_home.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="冬天" class="mdui-btn mdui-btn-icon"><img src="https://cdn.jsdelivr.net/gh/liangdongin/blog@latest/images/avatar.jpg" alt="冬天"></a>
       </div>
    </div>
  </div>
  <div id="nexmoe-header">
      <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="冬天">
            <img src="https://cdn.jsdelivr.net/gh/liangdongin/blog@latest/images/avatar.jpg" alt="冬天" alt="冬天">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>2</div>
        <div><span>标签</span>4</div>
        <div><span>分类</span>0</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/archives.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/py.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        <form id="search_form" action_e="https://cn.bing.com/search?q=site:www.liangdonglin.cn" onsubmit="return search();">
            <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
        </form>
    </div>
</div>
  
  <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/liangdongin/" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
  
  

  
  
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/NET/" style="font-size: 10px;">.NET</a> <a href="/tags/Win7/" style="font-size: 10px;">Win7</a> <a href="/tags/acme/" style="font-size: 10px;">acme</a> <a href="/tags/https/" style="font-size: 10px;">https</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


<style>
.nexmoe-widget .archive-list-count{
	position : absolute;
	right: 15px;
	top:9px;
	color: #DDD;
}
</style>

  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2020 冬天
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
        <section class="nexmoe-posts">
    
    <div class="nexmoe-post">
        <a href="/2020/12/11/acme/">
            
                <div class="nexmoe-post-cover mdui-ripple" style="padding-bottom: 66.66666666666666%;"> 
                    <img data-src="https://cdn.jsdelivr.net/gh/liangdongin/blog@latest/images/background_home.jpg" data-sizes="auto" alt="使用acme申请免费的HTTPS证书" class="lazyload">
                    <h1>使用acme申请免费的HTTPS证书</h1>
                </div>
            
        </a>

        <div class="nexmoe-post-meta nexmoe-rainbow">
            <a><i class="nexmoefont icon-calendar-fill"></i>2020年12月11日</a>
            <a><i class="nexmoefont icon-areachart"></i>1.7k 字</a>
            <a><i class="nexmoefont icon-time-circle-fill"></i>大概 9 分钟</a>
        </div>

        <article>
            
                <a id="more"></a>

<h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/acmesh-official/acme.sh/wiki/">acme 文档</a><br><a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt 证书颁发机构</a></p>
<h2 id="安装acme"><a href="#安装acme" class="headerlink" title="安装acme"></a>安装acme</h2><pre><code class="bash">curl https://get.acme.sh | sh</code></pre>
<p>默认安装目录在~/.acme.sh/</p>
<p>安装过程中会自动为你创建 cronjob, 每天 0:09 点自动检测所有的证书, 如果快过期了, 需要更新, 则会自动更新证书。</p>
<pre><code class="bash">9 0 * * * &quot;/root/.acme.sh&quot;/acme.sh --cron --home &quot;/root/.acme.sh&quot; &gt; /dev/null</code></pre>
<h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h3><p>–home 是要安装的自定义目录acme.sh。默认情况下，它安装到~/.acme.sh。<br>–config-home 是一个可写文件夹，acme.sh将在其中写入所有文件（包括cert / keys，configs）。默认情况下–home。<br>–cert-home 是自定义的目录，用于保存您颁发的证书。默认情况下，它保存在中–config-home。<br>–accountemail 是用于向Let’s Encrypt注册帐户的电子邮件，您将在此处收到续订通知电子邮件。默认为空。<br>–accountkey 是保存您帐户私钥的文件。默认情况下，它保存在中–config-home。<br>–useragent 请求的用户代理头的值。</p>
<h2 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h2><p>申请证书需要验证域名所有权</p>
<p>有三种方式验证</p>
<h3 id="1-HTTP-方式"><a href="#1-HTTP-方式" class="headerlink" title="1.HTTP 方式"></a>1.HTTP 方式</h3><p>HTTP方式需要在你的网站根目录下放置一个文件, 来验证你的域名所有权,完成验证。就可以生成证书了。<br>–webroot 为你网站的根目录，acme会自动生成验证文件到网站根目录下，申请完成后会自动删除验证文件。<br>-d 后面要申请证书的域名，可多个</p>
<p>缺点 不可申请泛域名</p>
<pre><code class="bash">acme.sh  --issue  -d www.liangdonglin.cn   --webroot  /www/www.liangdonglin.cn</code></pre>
<p>如果你用的是nginx或者apache,使用以下命令不需要指定网站根目录，它会自动根据配置完成验证。</p>
<pre><code class="bash">acme.sh  --issue   -d www.liangdonglin.cn   --nginx
acme.sh  --issue   -d www.liangdonglin.cn   --apache</code></pre>
<h3 id="1-DNS-方式"><a href="#1-DNS-方式" class="headerlink" title="1.DNS 方式"></a>1.DNS 方式</h3><p>需要添加DNS解析验证域名所有权<br>缺点 使用这种方式无法自动更新证书<br>优点<br>1.可以申请泛域名<br>2.可以在任意安装了acme的机器申请证书，只要在域名NS管理方添加一条TXT dns解析记录即可</p>
<h4 id="申请证书-1"><a href="#申请证书-1" class="headerlink" title="申请证书"></a>申请证书</h4><pre><code class="bash">acme.sh --issue -d *.liangdonglin.cn  --dns  --yes-I-know-dns-manual-mode-enough-go-ahead-please

[2020年 12月 18日 星期五 16:19:25 CST] Using CA: https://acme-v02.api.letsencrypt.org/directory
[2020年 12月 18日 星期五 16:19:25 CST] Creating domain key
[2020年 12月 18日 星期五 16:19:25 CST] The domain key is here: /root/.acme.sh/*.liangdonglin.cn/*.liangdonglin.cn.key
[2020年 12月 18日 星期五 16:19:25 CST] Single domain=&#39;*.liangdonglin.cn&#39;
[2020年 12月 18日 星期五 16:19:25 CST] Getting domain auth token for each domain
[2020年 12月 18日 星期五 16:19:30 CST] Getting webroot for domain=&#39;*.liangdonglin.cn&#39;
[2020年 12月 18日 星期五 16:19:30 CST] Add the following TXT record:
[2020年 12月 18日 星期五 16:19:30 CST] Domain: &#39;_acme-challenge.liangdonglin.cn&#39;
[2020年 12月 18日 星期五 16:19:30 CST] TXT value: &#39;86gDwJGcR26QvGkhl5oCZvFPL2Iv3FHEjLiZBCEBbyE&#39;
[2020年 12月 18日 星期五 16:19:30 CST] Please be aware that you prepend _acme-challenge. before your domain
[2020年 12月 18日 星期五 16:19:30 CST] so the resulting subdomain will be: _acme-challenge.liangdonglin.cn
[2020年 12月 18日 星期五 16:19:30 CST] Please add the TXT records to the domains, and re-run with --renew.
[2020年 12月 18日 星期五 16:19:30 CST] Please add &#39;--debug&#39; or &#39;--log&#39; to check more details.
[2020年 12月 18日 星期五 16:19:30 CST] See: https://github.com/acmesh-official/acme.sh/wiki/How-to-debug-acme.sh</code></pre>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="https://cdn.jsdelivr.net/gh/liangdongin/blog@latest/2020/12/11/acme/dns.jpg" alt="dns_image" class="lazyload"></p>
<h4 id="查看解析"><a href="#查看解析" class="headerlink" title="查看解析"></a>查看解析</h4><pre><code class="bash">dig -t txt  _acme-challenge.liangdonglin.cn @8.8.8.8

; &lt;&lt;&gt;&gt; DiG 9.11.4-P2-RedHat-9.11.4-16.P2.el7_8.6 &lt;&lt;&gt;&gt; -t txt _acme-challenge.liangdonglin.cn @8.8.8.8
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 57426
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;_acme-challenge.liangdonglin.cn. IN    TXT

;; ANSWER SECTION:
_acme-challenge.liangdonglin.cn. 299 IN    TXT    &quot;86gDwJGcR26QvGkhl5oCZvFPL2Iv3FHEjLiZBCEBbyE&quot;

;; Query time: 143 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: 五 12月 18 16:32:25 CST 2020
;; MSG SIZE  rcvd: 116</code></pre>
<h4 id="完成验证，得到证书"><a href="#完成验证，得到证书" class="headerlink" title="完成验证，得到证书"></a>完成验证，得到证书</h4><pre><code class="bash">acme.sh --renew -d *.liangdonglin.cn  --dns  --yes-I-know-dns-manual-mode-enough-go-ahead-please

[2020年 12月 18日 星期五 16:44:33 CST] Renew: &#39;*.liangdonglin.cn&#39;
[2020年 12月 18日 星期五 16:44:37 CST] Using CA: https://acme-v02.api.letsencrypt.org/directory
[2020年 12月 18日 星期五 16:44:37 CST] Single domain=&#39;*.liangdonglin.cn&#39;
[2020年 12月 18日 星期五 16:44:37 CST] Getting domain auth token for each domain
[2020年 12月 18日 星期五 16:44:37 CST] Verifying: *.liangdonglin.cn
[2020年 12月 18日 星期五 16:44:43 CST] Success
[2020年 12月 18日 星期五 16:44:43 CST] Verify finished, start to sign.
[2020年 12月 18日 星期五 16:44:43 CST] Lets finalize the order.
[2020年 12月 18日 星期五 16:44:43 CST] Le_OrderFinalize=&#39;https://acme-v02.api.letsencrypt.org/acme/finalize/53165097/6806687071&#39;
[2020年 12月 18日 星期五 16:44:46 CST] Downloading cert.
[2020年 12月 18日 星期五 16:44:46 CST] Le_LinkCert=&#39;https://acme-v02.api.letsencrypt.org/acme/cert/04470ac32d4f7cab1dd89c1721e29ad85813&#39;
[2020年 12月 18日 星期五 16:44:48 CST] Cert success.
[2020年 12月 18日 星期五 16:44:48 CST] Your cert is in  /root/.acme.sh/*.liangdonglin.cn/*.liangdonglin.cn.cer 
[2020年 12月 18日 星期五 16:44:48 CST] Your cert key is in  /root/.acme.sh/*.liangdonglin.cn/*.liangdonglin.cn.key 
[2020年 12月 18日 星期五 16:44:48 CST] The intermediate CA cert is in  /root/.acme.sh/*.liangdonglin.cn/ca.cer 
[2020年 12月 18日 星期五 16:44:48 CST] And the full chain certs is there:  /root/.acme.sh/*.liangdonglin.cn/fullchain.cer </code></pre>
<h2 id="API添加DNS验证"><a href="#API添加DNS验证" class="headerlink" title="API添加DNS验证"></a>API添加DNS验证</h2><p><a target="_blank" rel="noopener" href="https://github.com/acmesh-official/acme.sh/wiki/dnsapi">文档</a><br>优点 acme 自动调用域名解析商API自动添加DNS解析完成验证，能自动更新。<br>以GoDaddy为列<br>登录GoDaddy账号生成自己App_KEY和App_Secret</p>
<pre><code class="bash">export GD_Key=&quot;sdfsdfsdfljlbjkljlkjsdfoiwje&quot;
export GD_Secret=&quot;asdfsdafdsfdsfdsfdsfdsafd&quot;
acme.sh --issue --dns dns_gd -d example.com -d www.example.com</code></pre>
<h2 id="使用证书"><a href="#使用证书" class="headerlink" title="使用证书"></a>使用证书</h2><p>默认证书都是放在~/.acme.sh/，不建议直接使用此目录<br>使用以下命令copy证书到自定义证书文件存放位置</p>
<p>以nginx为列</p>
<pre><code class="bash">acme.sh --installcert  -d  &lt;domain&gt;.com   \
        --key-file   /etc/nginx/ssl/&lt;domain&gt;.key \
        --fullchain-file /etc/nginx/ssl/fullchain.cer \
        --reloadcmd  &quot;service nginx force-reload&quot;</code></pre>
<pre><code class="nginx">server &#123;

        listen 80;
        server_name www.liangdonglin.cn;
        rewrite ^/(.*) https://www.liangdonglin.cn/$1 redirect; 
&#125;

    server &#123;

        listen       443 ssl;
        server_name  www.liangdonglin.cn;
        index index.html;
        root /app/www;

        ssl_certificate /etc/nginx/ssl/fullchain.cer;
        ssl_certificate_key /etc/nginx/ssl/*.liangdonglin.cn.key;
        ssl_session_timeout 5m;
        ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4;
        ssl_session_cache shared:SSL:10m;
        ssl_prefer_server_ciphers on;

        location  /&#123;
            root html;
            index index.html index.htm;
  &#125;
&#125;</code></pre>
<p>先检查nginx配置文件</p>
<pre><code class="bash">nginx -t</code></pre>
<p>最后重启nginx</p>
<pre><code class="bash">service nginx force-reload or nginx -s reload</code></pre>
<h2 id="更新acme"><a href="#更新acme" class="headerlink" title="更新acme"></a>更新acme</h2><h3 id="手动更新"><a href="#手动更新" class="headerlink" title="手动更新"></a>手动更新</h3><pre><code class="bash">acme.sh --upgrade</code></pre>
<h3 id="开启自动更新"><a href="#开启自动更新" class="headerlink" title="开启自动更新"></a>开启自动更新</h3><pre><code class="bash">acme.sh  --upgrade  --auto-upgrade</code></pre>
<h3 id="关闭自动更新"><a href="#关闭自动更新" class="headerlink" title="关闭自动更新"></a>关闭自动更新</h3><pre><code class="bash">acme.sh  --upgrade  --auto-upgrade 0</code></pre>

            
        </article>
    </div>
    
</section>

    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,gh/highlightjs/cdn-release@9.15.8/build/highlight.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


<script src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>
 <script src="/js/app.js?v=1608289167996"></script>

  





    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?e2fda46cf39aa554c197fe6a71c85d6d';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>

</html>
